<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">
<ui:composition template="/jsp/include/template.xhtml">
	<ui:define name="head">
	<style type="text/css">
		.dr-stglpnl-h{background:none !important;border-style: none !important;} 
		.rich-stglpanel-header{background:none !important;}
		.dr-stglpnl{background:none !important;} 
		.rich-stglpanel{background:none !important;}
		.dr-mpnl-pnl {overflow:auto!important}		
		
		.modal-parecer fieldset{
			font-family: Tahoma;
		}
		
		.modal-parecer ul {
			padding: 0;
		}
			
		.modal-parecer ul li {
			list-style-type: none;
			background-image: url(../../images/resumo_bloco.gif);
			background-position: 0 3px;
			background-repeat: no-repeat;
			padding-left: 20px;
			font-size: 14px;
		}
		.modal-parecer ul li ul li{
			list-style-type: none;
			background-image: url(../../images/resumo_item.gif);
			background-position: 0 0;
			padding-left: 20px;
			background-repeat: no-repeat;
			font-size: 11px;
		}
		.modal-parecer ul li ul li ul li {
			list-style-type: none;
			background-image: url(../../images/resumo_apontamento.gif);
			background-position: 0 0;
			padding-left: 20px;
			background-repeat: no-repeat;
			font-size: 11px;
		}
			
		.modal-parecer ul i {
			background-image: url(../../images/resumo_observacao.gif);
			background-position: -2px 4px;
			background-repeat: no-repeat;
			padding: 3px 10px 3px 13px;
		}
		
        .modal-parecer h2 strong {
            color: red;
            text-transform: none;
            font-family: Tahoma;
            font-size: 14px;
            margin-left: 10px;
        }
	</style>
	</ui:define>
	<ui:define name="breadcrumb">
		<h:panelGroup id="pnlBread">
			<h:outputLabel value="#{msgsEfetuaVerificacao['BREAD']}" />
		</h:panelGroup>
	</ui:define>
	<ui:define name="conteudo">
		<div id="conteudo">
			<br />
			<ui:include src="/jsp/include/cabecalho_verificacao.xhtml" />
			<br />
			<h:form id="formEfetuaVerificacao">
				<script type="text/javascript">
				function dataTableSelectOneRadio(radio) {
					var id = radio.name.substring(radio.name.lastIndexOf(':'));
					var el = jQuery('input[type=radio]');
					for ( var i = 0; i &lt; el.length; i++) {
						if (el[i].name.substring(el[i].name.lastIndexOf(':')) == id) {
							el[i].checked = false;
						}
					}
					radio.checked = true;

					// Usado para funcionar no IE para que no momento da seleção do radiobutton já seja "chamado" o onchange. 
					if(jQuery.browser.msie) {
						radio.blur();  
				        radio.focus();
					}  

				}

				jQuery(document).ready(function(){
					atualizaTooltipEDesabilitados();					
				});

				function atualizaTooltipEDesabilitados(){
					jQuery('.checkDesabilita').each(function() {
						if(this.checked == true){
							click = this.attributes["onclick"].nodeValue;
							eval(click);
						}
					});
					jQuery('.desabilitadoPorPrejudicada').each(function() {
						escondePrejudicada(jQuery(this).attr('id'));
					});
		            jQuery('.toolTip').easyTooltip();
				}
			    
				function esconde(idCheck, idToggle){
					if(navigator.appName == "Microsoft Internet Explorer") {
						if(document.getElementById(idCheck).checked){
							 document.getElementById(idToggle+'_header').onclick = null;
							 document.getElementById(idToggle+'_body').style.display = 'none';
						}else{
							document.getElementById(idToggle+'_header').onclick = function(){ SimpleTogglePanelManager.toggleOnClient(event, idToggle); };
							document.getElementById(idToggle+'_body').style.display = 'none';
						}
					}else{
						if(document.getElementById(idCheck).checked){
							 document.getElementById(idToggle+'_header').setAttribute("onclick", "");
							 document.getElementById(idToggle+'_body').style.display = 'none';
						}else{
							document.getElementById(idToggle+'_header').setAttribute("onclick", "SimpleTogglePanelManager.toggleOnClient(event, '"+idToggle+"')");
							document.getElementById(idToggle+'_body').style.display = 'none';
						}
					}
				}
			    
				function escondePrejudicada(idToggle){
					if(navigator.appName == "Microsoft Internet Explorer") {
						document.getElementById(idToggle+'_header').onclick = null;
						document.getElementById(idToggle+'_body').style.display = 'none';
					}else{
						document.getElementById(idToggle+'_header').setAttribute("onclick", "");
						document.getElementById(idToggle+'_body').style.display = 'none';
					}
				}

				function nomeDoComponente(nome) {
					var id = 'calItem' + nome + 'InputDate';
					//alert(id);
					pegaValorDataItem(id, document.getElementById('formEfetuaVerificacao:'+id).value);
				}

				</script>
				<rich:spacer height="10" />
				<h:panelGroup
					layout="block"
					id="pnlTitleEfetuaVerificacao">
					<h:panelGroup
						layout="block"
						id="pnlLeftTitle"
						style="float:left">
						<h:graphicImage
							value="/images/icon_dados.jpg"
							style="vertical-align: bottom;" />
						<h:outputText
							id="lbl_titlePanelEfetuaVerificacao"
							value="#{msgsEfetuaVerificacao['TITLE.verificacoes']}"
							styleClass="tituloPagina" />
						<a4j:commandButton
							id="btnImportVerificacoesInconforme"
							styleClass="rich-button"
							style="margin-left:10px; width: 250px;"
							status="sts"
							actionListener="#{efetuaVerificacaoMB.doImportar}"
							rendered="#{efetuaVerificacaoMB.showImportaVerificacoesIncoformes}"
							reRender=":formEfetuaVerificacao, CEFMessagePanel"
							value="#{msgsEfetuaVerificacao['ACTION.importarVerificacao']}" />
					</h:panelGroup>
					<h:panelGroup
						layout="block"
						id="pnlRightSave"
						style="float:right">
						<h:commandButton
							id="btnSaveUp"
							value="#{msgsEfetuaVerificacao['ACTION.save']}"
							styleClass="rich-button"
							action="#{efetuaVerificacaoMB.doSave}"
							onclick="if(!confirm('#{msgsCef['MA003']}')) {return false;}" />
					</h:panelGroup>
				</h:panelGroup>
				<br clear="all" />
				<rich:spacer height="10" />
				<rich:panel
					id="pnlEfetuaVerificacao"
					style="width:100%"
					binding="#{efetuaVerificacaoMB.panelChecklist}">
					<rich:jQuery id="mskDatePesq" selector=".maskDate" timing="onload" query="mask('99/99/9999')" />
					<script type="text/javascript">
					
						<a4j:repeat value="#{efetuaVerificacaoMB.testA4jRepeat}" var="row" rowKeyVar="rowNum">
							arrayIconBloco[${rowNum}] = '${row}'; 
						</a4j:repeat>
					</script>
				</rich:panel>
				<h:panelGroup
					layout="block"
					id="pnlGravaVerificacao">
					<h:panelGroup
						layout="block"
						id="pnlGravaVerificacaoLeft"
						style="float:left;">
						<h:commandButton
							id="bntBack"
							value="#{msgsEfetuaVerificacao['ACTION.voltar']}"
							action="#{efetuaVerificacaoMB.doVoltar}"
							styleClass="rich-button-cinza rich-button" />
					</h:panelGroup>
					<h:panelGroup
						layout="block"
						id="pnlSaveVerificacaoRight"
						style="float:right;">
						<h:commandButton
							id="btnSaveDown"
							value="#{msgsEfetuaVerificacao['ACTION.save']}"
							action="#{efetuaVerificacaoMB.doSave}"
							styleClass="rich-button"
							onclick="if(!confirm('#{msgsCef['MA003']}')) {return false;}" />
						<rich:spacer width="15" />
						<a4j:commandButton
							id="btnEmitirParecer"
							value="#{msgsEfetuaVerificacao['ACTION.parecer']}"
							actionListener="#{efetuaVerificacaoMB.doEmitirParecer}"
							styleClass="rich-button"
							status="sts"
							onclick="if(!confirm('#{msgsEfetuaVerificacao['MSG.ConfirmSaveBeforeFeedback']}')) {return false;}"
							oncomplete="jsValidateToParecer();" 
							style="*width: 130px"
							reRender=":formEfetuaVerificacao, CEFMessagePanel" />
					</h:panelGroup>
				</h:panelGroup>
				<a4j:jsFunction 
					id="jsValidateToParecer"
					name="jsValidateToParecer"
					actionListener="#{efetuaVerificacaoMB.validateToParecer}" 
					data="#{efetuaVerificacaoMB.validToParecer}"
					reRender="CEFMessagePanel"
					oncomplete="if(data == 2){alert('#{msgsCef['MA012B']}'); return;}else if(data == '1'){jsExpandBloco();}else if(data == '3' || data == '4'){ return false; } else if(data != '2') { openModalParecer(); } " >
				</a4j:jsFunction>
				<a4j:jsFunction
					id="jsExpandBloco"
					name="jsExpandBloco"
					reRender="CEFMessagePanel"
					data="#{efetuaVerificacaoMB.blocoDataObrigatoria}"
					oncomplete="openAllBlocos(event, data);alert('#{msgsEfetuaVerificacao['MSG_ITENS_SEM_DATA_VALIDADE']}');" >					
				</a4j:jsFunction>
				<a4j:jsFunction 
					id="openModalParecer"
					name="openModalParecer"
					actionListener="#{efetuaVerificacaoMB.openModalParecer}"
					reRender="modalEmitirParecer"
					oncomplete="Richfaces.showModalPanel('modalEmitirParecer');" >					
				</a4j:jsFunction>
				<a4j:jsFunction
					name="pegaValorDataItem"
					actionListener="#{efetuaVerificacaoMB.doAdicionaDataItem}">
					<f:param name="idItem" />
					<f:param name="dataItem" />
				</a4j:jsFunction>
			</h:form>
			<h:form>
				<rich:modalPanel
					id="modalObservacao"
					width="700"
					height="250">
					<f:facet name="header">
						<h:outputText value="#{efetuaVerificacaoMB.headerModal}"  />
					</f:facet>
					<h:inputTextarea
						id="inputAreaBlocoItem"
						style="width:650px; height:150px;"
						styleClass="rotulos"
						value="#{efetuaVerificacaoMB.descricao}" />
					<br />
					<br />
					<h:panelGroup
						id="pnlActionModalObservacao"
						layout="block"
						style="text-align: center;">
						<a4j:commandButton
							id="CancelModal"
							value="#{msgsEfetuaVerificacao['ACTION.cancelar']}"
							styleClass="rich-button-cinza rich-button">
							<rich:componentControl
								for="modalObservacao"
								attachTo="CancelModal"
								operation="hide"
								event="onclick" />
						</a4j:commandButton>
						<rich:spacer width="10" />
						<a4j:commandButton
							id="SaveModal"
							value="#{msgsEfetuaVerificacao['ACTION.save']}"
							actionListener="#{efetuaVerificacaoMB.doSaveObservacao}"
							styleClass="rich-button"
							onclick="Richfaces.hideModalPanel('modalObservacao')">
						</a4j:commandButton>
					</h:panelGroup>
				</rich:modalPanel>
			</h:form>
				<rich:modalPanel
					showWhenRendered="#{efetuaVerificacaoMB.showModalEmitirParecer}"
					styleClass="modal-parecer"
					id="modalEmitirParecer"
					width="700"
					onshow="jQuery('.cef-message-panel').css('z-index', 101);"
					resizeable="true"
					height="400">
					<h:form id="formResumoParecer">
						<rich:panel>
							<f:facet name="header"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.resumoParecer']}" /></f:facet>
							<h:outputText value="#{efetuaVerificacaoMB.textoResumoParecer}" escape="false" />
						</rich:panel>
						<rich:panel>
							<f:facet name="header"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.assinaturaParecer']}" /></f:facet>
										<br/>
										<a4j:jsFunction id="jsAtualizaEmail"  actionListener="#{efetuaVerificacaoMB.atualizaEmails}" reRender="destinatarios, copias" name="jsAtualizaEmail" ajaxSingle="true" ></a4j:jsFunction>
										<div style="text-align: center;"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.selectGestor']}" /> </div>
										<rich:dataTable 
												value="#{efetuaVerificacaoMB.listGerentesUnidade}" 
												var="row"
												id="tableGerentesUnidade"
												width="100%"
												cellspacing="0"
												cellpadding="0"
												border="1"
												rowClasses="tabela-row-1, tabela-row-2"
												onRowMouseOver="this.style.backgroundColor = '#A2B6E5'"
												onRowMouseOut="this.style.backgroundColor = ''">
												
											<rich:column
												id="colCarregaContrato">
												<f:facet name="header">
													<h:outputText value="" />
												</f:facet>
												<center>
													<h:selectOneRadio
														id="cbSelectGerenteUnidade"
														value="#{efetuaVerificacaoMB.nuMatriculaGerenteUnidadeSelecionado}"
														onclick="dataTableSelectOneRadio(this);">
														<f:selectItem itemValue="#{row.nuMatricula}" />

														<a4j:support event="onchange" id="radioChangeEvent"
																	 oncomplete="jsAtualizaEmail();" ajaxSingle="true"
																	 
																	 >
															<f:setPropertyActionListener
																target="#{efetuaVerificacaoMB.nuMatriculaGerenteUnidadeSelecionado}"
																value="#{row.nuMatricula}"/>
														</a4j:support>
													</h:selectOneRadio>
												</center>
											</rich:column>
											<rich:column>
												<f:facet name="header"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.matricula']}" /></f:facet>
												<h:outputText value="#{row.strNuMatricula}" />
											</rich:column>
											<rich:column>
												<f:facet name="header"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.nome']}" /></f:facet>
												<h:outputText value="#{row.noPessoa}" />
											</rich:column>
											<rich:column>
												<f:facet name="header"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.funcao']}" /></f:facet>
												<h:outputText value="#{row.noFuncao}" />
											</rich:column>
											<rich:column>
												<f:facet name="header"></f:facet>
												<h:outputText value="#{row.strEventual}" />
											</rich:column>
										</rich:dataTable>
						</rich:panel>
						<br/>
						<rich:panel>
							<f:facet name="header"><h:outputText value="#{msgsEfetuaVerificacao['LABEL.emailsEnviar']}" /></f:facet>
							
							<div style="margin-left: 20px;">
								<h:outputLabel value="#{msgsEfetuaVerificacao['LABEL.destinatarios']}: " style="font-weight: bold;"/> 
								<h:outputText id="destinatarios" value="#{efetuaVerificacaoMB.listDestinatariosEnviar}" />
								<br/>
								
								<h:outputLabel value="#{msgsEfetuaVerificacao['LABEL.comCopia']}: " style="font-weight: bold;"/> 
								<h:outputText id="copias" value="#{efetuaVerificacaoMB.listDestinatariosEnviarComCopia}" />
							</div>
							
						</rich:panel>
						<div style="text-align: center;">
							<a4j:commandButton onclick="if(!confirm('#{msgsCef['MA001']}')) {return false;}" 
											   value="#{msgsEfetuaVerificacao['ACTION.save']}"
											   reRender="CEFMessagePanel" 
											   id="btnEmiteParecer"
											   ajaxSingle="true"
											   status="sts"
											   actionListener="#{efetuaVerificacaoMB.doSaveParecer}"
											   styleClass="rich-button"/>
							<rich:spacer width="15" />
							<a4j:commandButton onclick="Richfaces.hideModalPanel('modalEmitirParecer');"
											   actionListener="#{efetuaVerificacaoMB.closeModalParecer}"
											   reRender="pnlEfetuaVerificacao, CEFMessagePanel" 
											   value="#{msgsEfetuaVerificacao['ACTION.cancelar']}" 
											   styleClass="rich-button rich-button-cinza"/>
					    </div>
					</h:form>
				</rich:modalPanel>
		</div>
	</ui:define>
</ui:composition>
</html>